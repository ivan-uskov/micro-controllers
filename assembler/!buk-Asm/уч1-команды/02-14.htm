<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta name="Author" content="Dmitry L. Smirnoff (C) 2001">
<link REL="stylesheet" HREF="(Styles).css" TYPE="text/css">
<title>2.1.4. Регистр флажков</title>
</head>

<body background="(Фон).gif">

<hr>

<p>Регистр флажков EFlags состоит из следующих
частей. Его младшие 16 бит образуют регистр Flags,
имеющийся в 16-разрядных процессорах i8086/80286.
Биты 16-18 появились начиная с процессора i80386,
когда регистр флажков (вместе с остальными
регистрами) стал 32-разрядным. Кроме того, есть
биты 19-31, зарезервированные для использования в
последующих моделях процессоров семейства i80x86.
Из соображений совместимости все они имеют
нулевое значение пока не используются. Формат
регистра флажков приведен ниже.</p>

<h3><img src="02-14-рис01.gif"><br>
Рис.1. Регистр флажков EFlags (Flags)</h3>

<p>Флажки регистра EFlags подразделяются на восемь
флажков состояния и шесть флажков управления.</p>

<p><b>Флажки состояния</b> сообщают об особенностях
результата выполнения команды обработки данных.
Команды простой пересылки данных (например,
наиболее часто применяемая команда <i>mov</i>) не
воздействуют на флажки состояния. Команды
условных переходов позволяют программе учесть
состояния флажков и отреагировать на них.
Например, когда счетчик управления циклом
уменьшается до 0, изменяется состояние флажка ZF и
это изменение можно использовать для отмены
перехода в начало цикла.</p>

<p>К флажкам состояния относятся следующие
флажки. Отметим, что первые шесть из
рассматриваемых далее флажков называются еще
арифметическими флажками, так как они отражают
ту или иную особенность результата
арифметической или логической команды.

<ul>
  <li><b>CF</b> (Carry Flag) - флажок переноса. Он
    устанавливается в 1, если арифметическая
    операция вызвала перенос (при сложении) или заем
    (при вычитании) из старшего бита результата; в
    противном случае флажок CF сбрасывается в 0. В
    зависимости от размера операндов старшим битом
    может быть бит 7 (байты), 15 (слова) или 31 (двойные
    слова). Имеются специальные команды, с помощью
    которых можно перевести этот флажок в любое
    состояние или инвертировать его.</li>
  <li><b>PF</b> (Parity Flag) - флажок паритета (четности). Он
    устанавливается в 1, если младшие восемь бит
    результата содержат четное число единичных бит;
    в противном случае флажок PF сбрасывается в 0.
    Подчеркнем, что на его состояние влияет только
    младший байт результата.</li>
  <li><b>AF</b> (Auxiliary carry Flag) - флажок вспомогательного
    переноса. Он устанавливается в 1, если
    арифметическая операция вызвала перенос (при
    сложении) или заем (при вычитании) из младшей
    тетрады (т.е. бита 3) результата; в противном
    случае флажок AF сбрасывается в 0. Флажок AF
    изменяется только командами десятичной
    арифметики.</li>
  <li><b>ZF</b> (Zero Flag) - флажок нуля. Флажок ZF изменяется
    арифметическими командами. Он устанавливается в
    1, когда результат операции равен 0; в противном
    случае он сбрасывается в 0. Отметим, что операция
    сравнения двух чисел выполняется с помощью
    вычитания. При этом изменяется влажок ZF
    (если числа равны, то ZF=1, а если нет - тогда ZF=0), а
    результат вычитания нигде не сохраняется.</li>
  <li><b>SF</b> (Sign Flag) - флажок знака. Большинство команд
    устанавливают флажок SF в то же состояние, в каком
    находится старший бит результата. В зависимости
    от размера операндов им будет бит 7, 15 или 31. При
    использовании целых знаковых чисел,
    представленных в дополнительном коде, флажок SF
    показывает знак результата.</li>
  <li><b>OF</b> (Overflow Flag) - флажок переполнения. Флажок OF
    устанавливается в 1, если в арифметических
    операциях со знаковыми операндами результат
    превышает диапазон представимых чисел; в
    противном случае флажок OF сбрасывается в 0.
    Переполнение фиксируется, если значение
    переноса/заема в старший бит результата и из него
    не совпадают. В зависимости от размера операндов
    старшим битом является бит 7, 15 или 31.</li>
  <li><b>IOPL</b> (Input/Output Privilege Level) - уровень привилегий для
    выполнения команд ввода-вывода. Это двухбитное
    поле является составной частью механизма защиты
    процессора и действует только в защищенном
    режиме. Оно показывает тот минимальный уровень
    привилегий выполняющейся задачи, на котором
    разрешается использование команд, чтения/записи
    данных через порты ввода-вывода. Другими словами,
    механизм защиты привлекает поле IOPL для
    управления доступом к адресному пространству
    ввода-вывода.</li>
  <li><b>NT</b> (Nested Task) - флажок вложенной задачи. Флажок NT
    действует только в защищенном режиме и
    устанавливается в 1, когда текущая задача
    производит переключение на другую задачу с
    помощью команды вызова CALL. Таким образом, с
    помощью этого флажка организуется цепь
    вложенных задач аналогично вложению
    подпрограмм. Состояние флажка NT проверяет
    команда возврата из прерывания IRET и при NT = 1
    осуществляется переключение задачи, а при NT = 0
    происходит обычный возврат из прерывания.</li>
</ul>

<p><b>Флажки управления</b> в регистре EFLAGS
воздействуют на работу процессора. К ним
относятся:

<ul>
  <li><b>TF</b> (Trap Flag или Trace Flag) - флажок покомандной
    работы (трассировки) или ловушки. Когда этот
    флажок находится в состоянии 0, процессор
    работает обычным образом, а при TF = 1 после
    выполнения каждой команды генерируется
    внутреннее прерывание с переходом к отладчику.
    Этот флажок является одним из средств,
    предназначенных для отладки программ.</li>
  <li><b>IF</b> (Interrupt Flag) - флажок прерывания. Когда флажок
    IF находится в состоянии 1, процессор распознает и
    обрабатывает внешние аппаратные прерывания по
    входу INTR (говорят еще, что прерывания разрешены).
    Если же IF=0, тогда процессор игнорирует сигналы
    прерываний на своем входе INTR (прерывания запрещены или
    замаскированы). Отметим, что состояние флажка IF
    не влияет на восприятие внешних прерываний по
    входу немаскируемых прерываний NMI и внутренних
    прерываний, которые всегда выполняются процессором.
    Кроме того, в защищенном режиме команды, изменяющие
    состояние флажка IF, являются привилегированными,
    т.е. они могут исполнятся процессором только в режиме
    супервизора. В режиме пользователя эти команды
    вызывают ошибку защиты процессора.</li>
  <li><b>DF</b> (Direction Flag) - флажок направления. Этот флажок
    задает направление обработки цепочек. Если
    DF=0, то после выполнения цепочечной
    операции производится автоматический инкремент,
    а при DF=1 - автодекремент регистров ESI/SI и EDI/DI,
    адресующих цепочки. Говорят,
    что при DF=0 цепочки обрабатываются слева направо
    или вперед (от младших адресов к старшим), а при DF=1
    обработка цепочек производится справа налево
    или назад (от старших адресов к младшим). Величина
    инкремента/декремента составляет 1, 2 или 4 в
    зависимости от размера элементов цепочек (байт,
    слово или двойное слово). Для задания нужного
    состояния флажка DF имеются специальные команды.</li>
  <li><b>RF</b> (Resume Flag) - флажок возобновления. Данный
    флажок является составной частью новых средств
    отладки и действует совместно с регистрами
    отладки. Устанавливая флажок RF в состояние 1,
    можно выборочно маскировать некоторые особые
    случаи в процессе отладки программы. Флажок RF
    временно запрещает особые случаи отладки, чтобы
    осуществить рестарт команды после особого
    случая отладки без немедленного формирования
    еще одного особого случая отладки.</li>
  <li><b>VM</b> (Virtual Mode) - флажок режима виртуального
    процессора 8086 или V-режима (имеется только в процессоре i80386 и выше).
    Когда VM=0, процессор может работать в реальном
    или защищенном режиме, а при VM=1 процессор
    превращается в высокопроизводительный
    процессор 8086. Другими словами, установка флажка в
    состояние VM=1 переводит процессор в режим,
    который эмулирует программную среду процессора
    8086.</li>
  <li><b>AC</b> (Alignment Check) - флажок контроля выравнивания
    (имеется только в процессоре i80486 и выше).
    Установка в 1 бита АС (а также бита AM в регистре
    управления CR0) разрешает контроль выравнивания
    при обращении к памяти. Особый случай контроля
    выравнивания возникает при обращении к
    невыравненному операнду, например к слову с
    нечетным байтным адресом или к двойному слову,
    адрес которого не кратен четырем. Особые случаи
    выравнивания генерируются только в режиме
    пользователя (уровень привилегий 3). Контроль
    выравнивания обычно используется для проверки
    программ пользователя для повышения скорости их
    работы, т.к. доступ к выровненным данным
    происходит значительно быстрее.</li>
</ul>

<hr>

<p>Следующий раздел - “<a href="02-20.htm">2.2. Системные регистры</a>”</p>
</body>
</html>
