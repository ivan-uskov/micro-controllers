<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta name="Author" content="Dmitry L. Smirnoff (C) 2001">
<link REL="stylesheet" HREF="(Styles).css" TYPE="text/css">
<title>2.2.2. Регистры управления процессором</title>
</head>

<body background="(Фон).gif">

<hr>

<p>К регистрам управления (Control Registers) относятся
три регистра CRO, CR2 и CR3. Отметим, что функции
регистра CR1 пока не определены и при обращении к
нему возникает особый случай неверного кода
операции. Все регистры управления доступны
только программам с высшим уровнем привилегий.</p>

<p><b>Регистр CRO</b> содержит системные флажки,
которые управляют режимами или показывают
состояние, относящееся ко всему процессору, а не
к выполнению отдельной задачи. Программа не
должна пытаться изменить состояние любого
зарезервированного бита этого регистра. Их
всегда необходимо устанавливать на ранее
считанное значение. Младшие 16 бит регистра CRO
образуют регистр слова состояния машины MSW (Machine
Status Word), который имеется в процессоре i80286. Команда
LMSW загрузки слова состояния машины модифицирует
только младшие 16 бит регистра CRO.</p>

<p>В регистре CRO имеются следующие флажки
управления и состояния. 

<ul>
  <li><b>PG</b> (PaGing) - страничное преобразование. Этот бит
    разрешает (1) или запрещает (0) страничное
    преобразование адреса.</li>
  <li><b>CD</b> (Cache Disable) - запрещение кэш-памяти. Этот бит
    разрешает (0) или запрещает (1) внутреннюю
    кэш-память процессора. Когда CD=1, промахи в
    кэш-памяти не вызывают заполнения ее строки.
    Отметим, что попадания в кэш-памяти не
    запрещаются; для полного запрещения кэш-памяти
    ее необходимо очистить.</li>
  <li><b>NW</b> (Not Write-through) - несквозная запись. Этот бит в
    состоянии 0 разрешает сквозную запись и циклы
    недостоверности кэш-памяти, а в состоянии 1
    запрещает циклы недостоверности кэш-памяти и
    сквозные записи, вызвавшие попадания в
    кэш-памяти. Запрещение сквозной записи может
    привести к появлению в кэш-памяти устаревших
    данных.</li>
  <li><b>AM</b> (Alignment Mask) - маска выравнивания. Этот бит
    разрешает (1) или запрещает (0) контроль
    выравнивания. Контроль выравнивания
    производится, когда AM=1, флажок AC=1 и текущий
    уровень привилегий CPL=3 (режим пользователя).</li>
  <li><b>WP</b> (Write Protect) - защита от записи. В состоянии 1
    этот бит защищает от записи страницы уровня
    пользователя от обращений режима супервизора.
    Если же WP=0, процесс супервизора может записывать
    только в считываемые страницы уровня
    пользователя. Такая возможность удобна для
    реализации метода копирования записью (write-copy)
    при создании новой задачи, который применяется в
    некоторых операционных системах.</li>
  <li><b>NE</b> (Numeric Error) - численная ошибка. С помощью
    этого бита при установке его в 1 разрешается
    стандартный механизм оповещения о возникающих в
    программах численных ошибках.</li>
  <li><b>ЕТ</b> (Extension Type) - тип расширения. В состоянии 1
    этот бит разрешает выполнение команд
    математического сопроцессора i80387. Если бит ET
    равен 0, тогда допускается выполнение только
    команд сопроцессора i80287.</li>
  <li><b>TS</b> (Task Switched) - задача переключена. Процессор
    устанавливает этот бит в 1 при каждом
    переключении задачи и проверяет его при
    выполнении команд с плавающей точкой. Бит TS
    позволяет задержать сохранение/восстановление
    контекста устройства с плавающей точкой до
    фактического использования численных данных.
    Этот бит можно сбросить командой <i>clts</i>.</li>
  <li><b>ЕМ</b> (EMulation) - эмуляция. Когда бит ЕМ или TS
    установлен в 1, выполнение команды ожидания <i>wait</i>
    или любой команды с плавающей запятой генерирует
    особый случай недоступного сопроцессора. Это
    прерывание используется чтобы организовать
    работу программного эмулятора команд с
    плавающей запятой.</li>
  <li><b>МР</b> (Math Present) - сопроцессор присутствует. В
    процессорах i80286 и i80386 (с внешним сопроцессором)
    бит МР управляет функцией команды ожидания <i>wait</i>,
    которая применяется для синхронизации действий
    с сопроцессором. При выполнении программы в
    процессорах i80486 и Pentium (со встроенным
    сопроцессором) этот бит должен быть всегда
    установлен в 1.</li>
  <li><b>РЕ</b> (Protect Enable) - разрешение защиты. Если бит PE
    равен 0, тогда процессор находится в реальном
    режиме работы, а установка бита РЕ в 1 переключает
    процессор в защищенный режим работы.</li>
</ul>

<p>Из<b> регистра CR2</b> программа может только
считывать, а процессор загружает в него
последний 32-битный линейный адрес, который
вызвал страничное нарушение (особый случай №14).
Обработчик этого особого случая привлекает
содержимое регистра CR2 для выяснения причин
особого случая.</p>

<p><b>Регистр управления CR3</b> в своих старших 20
битах содержит физический адрес каталога
страниц (таблиц страниц первого уровня) и
называется <b>базовым регистром каталога страниц
PDBR</b>. Отметим, что каталог страниц должен быть
выравнен по границе страниц (4Кбайта), поэтому
младшие 12 бит регистра PDBR игнорируются. В отличие
от процессора 80386 в процессоре i80486 в этом поле
задействованы два бита, которые применяется для
управления кэшированием страниц во внешней
кэш-памяти: 

<ul>
  <li><b>PCD</b> (Page Cache Disable) - запрещение кэширования
    страницы (в состоянии 1).</li>
  <li><b>PWT</b> (Page Write-Through) - сквозная запись в страницу. В
    этом режиме любые изменения данных во внешней
    кэш-памяти немедленно записываются в память.
    Сброшенный бит PWT разрешает кэширование с
    обратной записью, при котором модификации в
    кэш-памяти записываются в память только по
    специальному запросу.</li>
</ul>

<hr>

<p>Следующий раздел - “<a href="02-23.htm">2.2.3. Регистры
отладки программ</a>”</p>
</body>
</html>
